<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Star Wars RPG game</title>
  <link rel="stylesheet" href="assets/css/reset.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
    crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Monoton" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
  <header>
    <h1 id="heading">STARS WARS - RPG game</h1>
  </header>

  <div class="container">
    <h2>Rules: 1) select character 2) select defender 3) Attack! 4) Repeat 2 and 3</h2>
    <div id="start">
      <div id="darthVader">
        Darth Vader
        <br>
        <img class='img-thumbnail' src="assets/images/darthVader.jpg" alt="">
        <br>
        <p id="darthVaderValue">120</p>
      </div>
      <div id="hanSolo">
        Han Solo
        <br>
        <img class='img-thumbnail' src="assets/images/hanSolo.jpg" alt="">
        <br>
        <p id="darthVaderValue">100</p>
      </div>
      <div id="chewbecca">
        Chewbecca
        <br>
        <img class='img-thumbnail' src="assets/images/chewbecca.jpg" alt="">
        <br>
        <p id="darthVaderValue">150</p>
      </div>
      <div id="yoda">
        Yoda
        <br>
        <img class='img-thumbnail' src="assets/images/yoda.jpg" alt="">
        <br>
        <p id="darthVaderValue">180</p>
      </div>
    </div>
    <h2>Your character</h2>
    <div id="character"></div>
    <h2>Enemies Available To Attack</h2>
    <div id="enemies"></div>
    <h2>Fight Section</h2>
    <button id="attack">Attack</button>
    <div id="message"></div>
    <h2>Defender</h2>
    <div id="defender"></div>
  </div>


  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
  <script>
    $(document).ready(function () {

      function selectCharacter(characterHP, characterName, ap) {

        $("#darthVader, #hanSolo, #chewbecca, #yoda").on("click", function (event) {
          // remove characters from the start div
          $("#start").empty();

          // display selected character
          var chosenCharacter = event.currentTarget.id;
          console.log(chosenCharacter);
          $("#character").html(`<div id=${chosenCharacter}> ${characterName[chosenCharacter]}<br><img class='img-thumbnail' src="assets/images/${chosenCharacter}.jpg" alt=""><br><p id="${chosenCharacter}Value">${characterHP[chosenCharacter]}</p></div>`)

          // display enemies
          var enemies = Object.keys(characterName).filter(enemy => {
            return enemy !== chosenCharacter
          });
          enemies.forEach((enemy) => {
            // append enemies
            $("#enemies").append(`<div id=${enemy}> ${characterName[enemy]}<br><img class='img-thumbnail' src="assets/images/${enemy}.jpg" alt=""><br> <p id="${enemy}Value">${characterHP[enemy]}</p></div>`);
            $(`#${enemy}`).css({ "background-color": "red", "border-color": "black", "border-width": "1px", "padding": "2px" });
          })
          // change background color to red
          var enemyIDs = enemies.map(enemy => {
            return "#" + enemy
          }).toString()
          console.log(enemyIDs);

          // choose one character
          var click = 0

          $(enemyIDs).one("click", function (enemy) {
            click++
            console.log(click)
            if (click === 1) {
              var enemy = enemy.currentTarget.id;
              // remove enemy from enemies div
              $("#" + enemy).remove();
              console.log("#" + enemy);

              // add enemy to defender div
              $("#defender").html(`<div id=${enemy}> ${characterName[enemy]}<br><img class='img-thumbnail' src="assets/images/${enemy}.jpg" alt=""><br> <p id="${enemy}Value">${characterHP[enemy]}</p></div>`)
            }
          });
        })
      }

      function displayEnemy(remainingEnemies, characterName, characterHP) {
        console.log(remainingEnemies.toString())
        $(remainingEnemies.toString()).one("click", function (enemy) {
          var enemy = enemy.currentTarget.id;
          console.log(characterName)
          // remove enemy from enemies div
          $("#" + enemy).remove();
          console.log("#" + enemy);

          // add enemy to defender div
          $("#defender").html(`<div id=${enemy}> ${characterName[enemy]}<br><img class='img-thumbnail' src="assets/images/${enemy}.jpg" alt=""><br> <p id="${enemy}Value">${characterHP[enemy]}</p></div>`)
          $("#defender").show();
        });
      }

      function attack(characterHP, characterName, ap) {
        var defeatedEnemyList = [];
        var clicks = 0;
        $("#attack").on("click", function (event) {
          clicks++

          // determine character and enemy
          var character = $("#character").children()[0].id
          var enemy = $("#defender").children()[0].id

          characterHP[enemy] -= ap[character] * clicks
          console.log(characterHP[enemy] + ":" + ap[character])
          $("#" + enemy + "Value").html(characterHP[enemy])

          if (characterHP[character] > 0 && characterHP[enemy] > 0) {
            characterHP[character] -= ap[enemy]
            console.log(characterHP[character] + ":" + ap[enemy])
            $("#" + character + "Value").html(characterHP[character])

            $("#message").html(`<p>You attacked ${characterName[enemy]} for ${ap[character] * clicks} damage.</p><p>${characterName[enemy]} attacked you back for ${ap[enemy]} damage.`)
          } else if (characterHP[character] > 0 && characterHP[enemy] < 0) {
            defeatedEnemyList.push(enemy);
            $("#message").html(`<p>You have defeated ${characterName[enemy]}, you can choose to fight another enemy.</p>`)
            $("#defender").hide();
            // console.log(characterHP[enemy])
            // console.log(characterHP + characterName + ap)
            var remainingEnemies = [];
            for (let i = 0; i < $("#enemies").children().length; i++) {
              remainingEnemies.push("#" + $("#enemies").children()[i].id)
            }
            // console.log(remainingEnemies)
            displayEnemy(remainingEnemies, characterName, characterHP)
            // attack2(characterHP, characterName, ap);

            if (defeatedEnemyList.length === 3) {
              $("#message").text("You win!! GAME OVER!!");
              $("#message").append("<br><button id='restart'>Restart</button>")
            }
          } else {
            $("#message").text("You have been defeated... GAME OVER!!");
            $("#message").append("<br><button id='restart'>Restart</button>")
          }
        });
      }

      function attack2(characterHP, characterName, ap) {
        console.log(characterHP)
        console.log(characterName)
        console.log(ap)
      }

      function reset() {
        var characterHP = {
          darthVader: 120,
          hanSolo: 100,
          chewbecca: 150,
          yoda: 180
        }
        var characterName = {
          darthVader: "Darth Vader",
          hanSolo: "Han Solo",
          chewbecca: "Chewbecca",
          yoda: "Yoda"
        }
        // Counter Attack Points
        var ap = {
          darthVader: 8,
          hanSolo: 5,
          chewbecca: 20,
          yoda: 25
        }
        selectCharacter(characterHP, characterName, ap);
        attack(characterHP, characterName, ap);
      }

      $(document).on("click", "#restart", function () {
        console.log(event);
        console.log("restart clicked!")
        $(".container").html('<h2>Rules: 1) select character 2) select defender 3) Attack! </h2><div id="start"><div id="darthVader">Darth Vader<br><img class="img-thumbnail" src="assets/images/darthVader.jpg" alt=""><br><p id="darthVaderValue">120</p></div><div id="hanSolo">Han Solo<br><img class="img-thumbnail" src="assets/images/hanSolo.jpg" alt=""><br><p id="darthVaderValue">100</p></div><div id="chewbecca">Chewbecca<br><img class="img-thumbnail" src="assets/images/chewbecca.jpg" alt=""><br><p id="darthVaderValue">150</p></div><div id="yoda">Yoda<br><img class="img-thumbnail" src="assets/images/yoda.jpg" alt=""><br><p id="darthVaderValue">180</p></div></div><h2>Your character</h2><div id="character"></div><h2>Enemies Available To Attack</h2><div id="enemies"></div><h2>Fight Section</h2><button id="attack">Attack</button><div id="message"></div><h2>Defender</h2><div id="defender"></div>')
        reset()
      })


      reset();


    });
  </script>
</body>

</html>